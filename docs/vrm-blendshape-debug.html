<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRM ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ— ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .file-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .file-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .analysis-result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        pre { background: #000; color: #0f0; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” VRM ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ— ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
        <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€VRMãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’åˆ†æã—ã€BMIä½“å‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½¿ç”¨å¯èƒ½ãªãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’ç‰¹å®šã—ã¾ã™ã€‚</p>
        
        <div class="file-list" id="fileList">
            <!-- VRMãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
        
        <div id="analysisResults" style="margin-top: 30px;">
            <h2>åˆ†æçµæœ</h2>
            <div id="results"></div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@latest/build/three.module.js';
        import { GLTFLoader } from 'https://unpkg.com/three@latest/examples/jsm/loaders/GLTFLoader.js';
        
        // VRMãƒ­ãƒ¼ãƒ€ãƒ¼ã¯å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒã§ã¯@pixiv/three-vrmã‚’ä½¿ç”¨
        console.log('Three.jsèª­ã¿è¾¼ã¿å®Œäº†');
        
        // VRMãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆï¼ˆå®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«åˆã‚ã›ã¦æ›´æ–°ï¼‰
        const vrmFiles = [
            'f_0_17.vrm', 'f_0_18.vrm', 'f_0_19.vrm', 'f_0_20.vrm', 'f_0_22.vrm', 'f_0_25.vrm',
            'f_1_22.vrm', 'f_1_25.vrm', 'f_2_22.vrm',
            'm_0_22.vrm', 'm_1_22.vrm', 'm_2_22.vrm'
        ];
        
        function createFileCard(filename) {
            const card = document.createElement('div');
            card.className = 'file-card';
            card.innerHTML = `
                <h3>${filename}</h3>
                <p><strong>æ¨æ¸¬ã•ã‚Œã‚‹æƒ…å ±:</strong></p>
                <ul>
                    <li>æ€§åˆ¥: ${filename.includes('f_') ? 'å¥³æ€§' : filename.includes('m_') ? 'ç”·æ€§' : 'ä¸æ˜'}</li>
                    <li>BMIå€¤: ${filename.match(/\d+(?:\.vrm)?$/) ? filename.match(/\d+(?:\.vrm)?$/)[0].replace('.vrm', '') : 'ä¸æ˜'}</li>
                </ul>
                <button onclick="analyzeVRM('${filename}')">ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’åˆ†æ</button>
                <div class="analysis-result" id="result-${filename.replace('.', '_')}" style="display: none;">
                    <!-- åˆ†æçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            `;
            return card;
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
        const fileList = document.getElementById('fileList');
        vrmFiles.forEach(filename => {
            fileList.appendChild(createFileCard(filename));
        });
        
        window.analyzeVRM = async function(filename) {
            const resultDiv = document.getElementById(`result-${filename.replace('.', '_')}`);
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>åˆ†æä¸­...</p>';
            
            try {
                // ã“ã®éƒ¨åˆ†ã¯å®Ÿéš›ã®VRMãƒ­ãƒ¼ãƒ€ãƒ¼å®Ÿè£…ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
                resultDiv.innerHTML = `
                    <h4>ğŸ” åˆ†æçµæœ: ${filename}</h4>
                    <div class="warning">
                        <p><strong>æ³¨æ„:</strong> ã“ã®é™çš„HTMLã§ã¯å®Ÿéš›ã®VRMãƒ•ã‚¡ã‚¤ãƒ«åˆ†æã¯ã§ãã¾ã›ã‚“ã€‚</p>
                        <p>å®Ÿéš›ã®åˆ†æã‚’è¡Œã†ã«ã¯ï¼š</p>
                        <ol>
                            <li>Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•</li>
                            <li>SimpleVRMViewerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨</li>
                            <li>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æœ‰åŠ¹ã«ã™ã‚‹</li>
                            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª</li>
                        </ol>
                    </div>
                    <div class="analysis-result">
                        <h5>æ¨å¥¨ã•ã‚Œã‚‹ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—å:</h5>
                        <ul>
                            <li><code>belly</code> - ãŠè…¹ã®è†¨ã‚‰ã¿</li>
                            <li><code>fat</code> - å…¨ä½“çš„ãªè„‚è‚ª</li>
                            <li><code>weight</code> - ä½“é‡å¤‰åŒ–</li>
                            <li><code>body</code> - ä½“å‹å…¨ä½“</li>
                            <li><code>waist</code> - ã‚¦ã‚¨ã‚¹ãƒˆ</li>
                        </ul>
                        <h5>ç¢ºèªæ–¹æ³•:</h5>
                        <pre>
// ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
const vrmPath = '/vrm-models/${filename}';
VRMDebugAnalyzer.analyzeVRMFile(vrmPath)
  .then(analysis => {
    console.log('åˆ†æçµæœ:', analysis);
    VRMDebugAnalyzer.printAnalysisResults(analysis);
  });
                        </pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }
        
        // å…¨ä½“çš„ãªæ¨å¥¨äº‹é …ã‚’è¡¨ç¤º
        document.getElementById('results').innerHTML = `
            <div class="analysis-result">
                <h3>ğŸ’¡ å…¨ä½“çš„ãªæ¨å¥¨äº‹é …</h3>
                <h4>1. ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã®å„ªå…ˆé †ä½:</h4>
                <ol>
                    <li><strong>belly</strong> - æœ€ã‚‚å…·ä½“çš„ã§åŠ¹æœçš„</li>
                    <li><strong>fat</strong> - è„‚è‚ªåˆ†å¸ƒã®å¤‰åŒ–</li>
                    <li><strong>weight</strong> - ä½“é‡å¤‰åŒ–å…¨èˆ¬</li>
                    <li><strong>body</strong> - ä½“å‹å…¨ä½“ã®å¤‰åŒ–</li>
                    <li><strong>waist</strong> - ã‚¦ã‚¨ã‚¹ãƒˆéƒ¨åˆ†</li>
                </ol>
                
                <h4>2. å®Ÿè£…ã®ã‚¹ãƒ†ãƒƒãƒ—:</h4>
                <ol>
                    <li>SimpleVRMViewerã§å„VRMãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿</li>
                    <li>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æœ‰åŠ¹ã«ã—ã¦å®Ÿéš›ã®ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’ç¢ºèª</li>
                    <li>avatarConfig.tsã®è¨­å®šã‚’æ›´æ–°</li>
                    <li>BMIå€¤ã¨ã®å¯¾å¿œé–¢ä¿‚ã‚’ãƒ†ã‚¹ãƒˆ</li>
                </ol>
                
                <h4>3. ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰:</h4>
                <pre>
// Next.jsã‚¢ãƒ—ãƒªã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
// 1. VRMãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°åˆ†æ
await VRMDebugAnalyzer.analyzeVRMFile('/vrm-models/f_0_22.vrm');

// 2. BMIæ¨å¥¨ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã®å–å¾—
const analysis = await VRMDebugAnalyzer.analyzeVRMFile('/vrm-models/f_0_22.vrm');
const recommended = VRMDebugAnalyzer.recommendBMIBlendShapes(analysis);
console.log('æ¨å¥¨ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—:', recommended);

// 3. ç¾åœ¨ã®VRMã®ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ä¸€è¦§
if (window.vrmRef && window.vrmRef.current) {
  window.vrmRef.current.scene.traverse(object => {
    if (object.morphTargetDictionary) {
      console.log('ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—:', Object.keys(object.morphTargetDictionary));
    }
  });
}
                </pre>
            </div>
        `;
    </script>
</body>
</html>